<!DOCTYPE html>
<html lang="lv">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>TÄ“riÅ†u PÄrskats</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>

<div class="app">

  <!-- WELCOME -->
  <section class="card welcome">
    <h1>Sveiki!</h1>
    <p>Ko tu esi iztÄ“rÄ“jis?</p>
    <button class="btn btn-dark" onclick="goToChart()">Uz tÄ“riÅ†u pÄrskatu</button>
  </section>

  <!-- CHART -->
  <section class="card stats" id="chart">
    <h2>TÄ“riÅ†u sadalÄ«jums</h2>
    <div class="chart" id="pie"></div>
    <div class="legend" id="legend"></div>
    <button class="btn btn-yellow" onclick="openModal('expenseModal')">+ Pievienot tÄ“riÅ†us</button>
  </section>

  <!-- SETTINGS -->
  <section class="card welcome">
    <h2>IestatÄ«jumi</h2>
    <button class="btn btn-dark" onclick="openModal('settingsModal')">AtvÄ“rt iestatÄ«jumus</button>
  </section>

</div>

<!-- ADD EXPENSE -->
<div class="modal" id="expenseModal">
  <div class="modal-box">
    <h3>Pievienot tÄ“riÅ†us</h3>
    <input type="number" id="amount" placeholder="Summa â‚¬">
    <select id="category"></select>
    <button class="btn btn-dark" onclick="addExpense()">SaglabÄt</button>
    <button class="btn btn-light" onclick="closeModal()">AtpakaÄ¼</button>
  </div>
</div>

<!-- SETTINGS MAIN -->
<div class="modal" id="settingsModal">
  <div class="modal-box">
    <h3>IestatÄ«jumi</h3>
    <button class="btn btn-dark" onclick="openModal('themeModal')">TÄ“ma</button>
    <button class="btn btn-dark" onclick="openModal('listModal')">Saraksta iestatÄ«jumi</button>
    <button class="btn btn-light" onclick="closeModal()">AtpakaÄ¼</button>
  </div>
</div>

<!-- THEME -->
<div class="modal" id="themeModal">
  <div class="modal-box">
    <h3>TÄ“mas izvÄ“le</h3>
    <button class="btn btn-dark" onclick="setTheme('dark')">TumÅ¡Ä</button>
    <button class="btn btn-light" onclick="setTheme('light')">GaiÅ¡Ä</button>
    <button class="btn btn-light" onclick="closeModal()">AtpakaÄ¼</button>
  </div>
</div>

<!-- LIST SETTINGS -->
<div class="modal" id="listModal">
  <div class="modal-box">
    <h3>Saraksta iestatÄ«jumi</h3>
    <label>
      <input type="checkbox" id="toggleAmounts" onchange="toggleAmounts()">
      RÄdÄ«t summas
    </label>
    <button class="btn btn-light" onclick="closeModal()">AtpakaÄ¼</button>
  </div>
</div>

<script>
const categories = {
  Pirkumi: { v:0, c:"#60a5fa", i:"ğŸ›’" },
  Online: { v:0, c:"#38bdf8", i:"ğŸ’»" },
  Ä’diens: { v:0, c:"#4ade80", i:"ğŸ½" },
  Abonementi:{ v:0, c:"#f87171", i:"ğŸ“º" },
  KomunÄlie:{ v:0, c:"#facc15", i:"ğŸ " },
  PÄrskaitÄ«jumi:{ v:0, c:"#c084fc", i:"ğŸ’¸" }
  PÄrskaitÄ«jumi:{ v:0, c:"#c084fc", i:"ğŸ’¸" }
};

let showAmounts = JSON.parse(localStorage.getItem("showAmounts")) ?? true;

function save() {
  localStorage.setItem("data", JSON.stringify(categories));
  localStorage.setItem("theme", document.body.dataset.theme);
  localStorage.setItem("showAmounts", showAmounts);
}

function load() {
  const d = JSON.parse(localStorage.getItem("data"));
  if (d) Object.keys(categories).forEach(k => categories[k].v = d[k].v);
  setTheme(localStorage.getItem("theme") || "dark");
  document.getElementById("toggleAmounts").checked = showAmounts;
  update();
}

function openModal(id) {
  document.querySelectorAll(".modal").forEach(m=>m.style.display="none");
  document.getElementById(id).style.display="flex";
}

function closeModal() {
  document.querySelectorAll(".modal").forEach(m=>m.style.display="none");
}

function addExpense() {
  const a = +amount.value;
  const c = category.value;
  if(!a) return;
  categories[c].v += a;
  save(); update(); closeModal();
}

function update() {
  const total = Object.values(categories).reduce((s,x)=>s+x.v,0);
  if(!total) return;
  let cur=0, g=[], l="";
  Object.entries(categories).forEach(([n,o])=>{
    if(!o.v) return;
    let p=o.v/total*100;
    g.push(`${o.c} ${cur}% ${cur+p}%`);
    cur+=p;
    l+=`<div class="legend-item">
      <span class="rect" style="background:${o.c}"></span>
      ${o.i} ${n} â€” ${p.toFixed(1)}%
      ${showAmounts?` (${o.v.toFixed(2)} â‚¬)`:``}
    </div>`;
  });
  pie.style.background=`conic-gradient(${g})`;
  legend.innerHTML=l;
}

function setTheme(t){document.body.dataset.theme=t;save();}
function toggleAmounts(){showAmounts=!showAmounts;save();update();}
function goToChart(){chart.scrollIntoView({behavior:"smooth"});}

const category=document.getElementById("category");
Object.keys(categories).forEach(k=>{
  category.innerHTML+=`<option value="${k}">${categories[k].i} ${k}</option>`;
});

load();
</script>

</body>
</html>
